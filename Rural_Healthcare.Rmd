---
title: "The Exponential Cost of Time When In a  Life or Death Emergency: \n The Struggle for Healthcare Accessability in Rural America "
author: "Group 02: Ana Porro and Victoria Zheng"
date: "November 30th, 2018"
output:
  html_document:
    highlight: tango
    theme: yeti
    toc: yes
    toc_depth: 2
    toc_float:
      collapsed: false
    df_print: kable
---

![](http://www.healthmediapolicy.com/wp-content/uploads/2017/05/RuralHospital.jpg)

```{r, echo=FALSE, message=FALSE, warning=FALSE}
# Set R Markdown chunk defaults:
knitr::opts_chunk$set(
  echo = FALSE, message = FALSE, warning = FALSE, 
  fig.width = 16/2, fig.height = 9/2
)
```


```{r, echo=FALSE, message=FALSE, warning=FALSE}
# Load all necessary packages here. It's a good idea to load all packages at 
# the beginning of a Rmd file so that collaborators can see in one shot all
# packages they'll need to ensure are installed beforehand:
library(tidyverse)
library(leaflet)
library(sf)
library(maps)
library(RColorBrewer)
library(stringr)
library(tidycensus)

#Just a heads up as a user running this code, a CensusBureau API key is required to produce the static map showing population density for Massachusetts.

# Do your data loading and wrangling (if any) here:

#Reading in our hospital shapefiles with the geospatial coordinates for U.S. hospitals

hospitals <- "Hospitals_Folder" %>%
  sf::read_sf() 

#Here we are narrowing down this large data set to include only hospitals that #are able to provide emergency services to the public, which in this case are
#general acute care and critical acces. Then open hospitals are filtered as we only want to look at currently operating hosipitals in the state of massachusetts and bordering states to see if there are more-accessible hospitals just across the state lines. We also filter for hospitals that can take in patients through our filtering for beds with positive capacity.

ma_er_hospitals <- hospitals %>%
  filter(TYPE == "GENERAL ACUTE CARE" |
         TYPE == "CRITICAL ACCESS",
         STATUS == "OPEN",
         STATE == "MA" | STATE == "VT" | STATE == "RI" | 
         STATE ==  "NY" | STATE == "NH"| STATE =="CT",
         !OWNER == "NOT AVAILABLE",
         BEDS >= 0) %>%
 
#Here we are simplyifying the types of owners for ease in reading in the leaflet #visualization so we code all government funded hospitals in a new variable to depict government
  
   mutate(SIMPLEOWNER = recode(OWNER,
                          "GOVERNMENT - DISTRICT/AUTHORITY" = "GOVERNMENT",
                          "GOVERNMENT - FEDERAL" = "GOVERNMENT",
                          "GOVERNMENT - LOCAL" = "GOVERNMENT",
                          "GOVERNMENT - STATE" = "GOVERNMENT"
                                              )) 

# Here we assign colors to the different hospital owners in order to visually discern on the map the general trend of hospital owners and if the MASS government is currently making many strides to fund hospital care.


ma_er_hospitals <- ma_er_hospitals %>%
  mutate(color = recode(SIMPLEOWNER, 
                           "NON-PROFIT" = "purple",
                          "PROPRIETARY" = "orange",
                          "GOVERNMENT" = "green"  )) 
 

#Add new variable BedGROUPS to sort the number of beds into designated bins #corresponding to a particular size range, helping us to represent this data #through the circle markers on the map and the legend.
  
 ma_er_hospitals$BEDGROUPS <- cut(ma_er_hospitals$BEDS, breaks = c(0,75, 150, 225, 300, 375, 450, 525,Inf),
                            labels = c("0-75",
                                    "76-150",
                                    "151-225",
                                    "226-300",
                                    "301-375",
                                    "376-450",
                                    "451-525",
                                    "526 and above"
                                ))
   
 #Here we create a new varriable corresponding to that of the bed bins in order to use this variable for radius size of the circle marker in the second leaflet plot.
 
  ma_er_hospitals <- ma_er_hospitals %>%    
  mutate(RSIZE = recode(BEDGROUPS,
                                     "0-75"  =  "2",
                                    "76-150" =  "4",
                                    "151-225" = "6",
                                    "226-300" = "8",
                                    "301-375" = "10",
                                    "376-450" = "12",
                                    "451-525" = "14",
                                    "526 and above" = "16" )) %>%
   
#Here we assign the BEDGROUPS we found above to a color to be used for plotting the hospital size points on the leaflet map
     mutate(BEDCOLORS = recode(BEDGROUPS,
                                      "0-75"  =  "#ffffcc",
                                    "76-150" =  "#ffeda0",
                                    "151-225" = "#fed976",
                                    "226-300" = "#feb24c",
                                    "301-375" = "#fd8d3c",
                                    "376-450" = "#fc4e2a",
                                    "451-525" = "#e31a1c",
                                    "526 and above" = "#b10026"
                              ))
```



# Rural Healthcare

##Starting the Conversation: Why are Hospitals important in Massachusetts?

There is a prevelant issue of rural populations having a lack of access to health services and emergency resources across the country. This is incredibly troublesome as death and serious injury accidents consist of a whopping [60 percent of total rural accidents versus only 48 percent of urban](https://www.ruralhealthweb.org/getattachment/Advocate/Policy-Documents/FutureofRuralHealthFeb-2013.pdf.aspx). These serious injury accidents can cause a [higher rate of morbidity and mortality](https://www.ruralhealthweb.org/getattachment/Advocate/Policy-Documents/FutureofRuralHealthFeb-2013.pdf.aspx) due to the severly long delays in calling for an EMS provider and the longer distance required to get oneself to a hospital for emergency treatment. In this blogpost we want to investigate if this same national absence of emergency healthcare providers exists in Massachusetts and if existing public policy supports emergency rural healthcare. We used datafrom the [Homeland Infrastructure Foundation-Level Data](https://hifld-geoplatform.opendata.arcgis.com/datasets/hospitals?geometry=-224.813%2C7.236%2C28.312%2C56.489) providing geospatial data and characteristics of hospitals around the US collected from State departments and Federal sources. We also used data from the [US Census Bureau](https://www.census.gov/programs-surveys/decennial-census/data/datasets.2010.html) that gives us the population density data for Massachusetts from their Decennial national collection of population and housing statistics to see if current hospitals are currently meeting MA constituents' needs. 


# Massachusetts Hospital Size and Distribution Across the State

The map below shows "Critical Access" and "General Acute Care Hospitals" in other words hospitals equipped to handle a civillian emergency (as these are the most prevalent rural accidents) and are color coded and sized so that each point represents a range of the number of available beds.Beds are used as a proxy for capacity with the lighter and smaller points connoting a hospital with a small capacity and the bigger and darker points representing a larger capacity hospital. 

```{r, echo=FALSE, message=FALSE, warning=FALSE}

# string r wrangling for a combined, complex popup to show both the range of beds and the hospital name for the second interactive map
ma_er_hospitals$super_popup <- paste(ma_er_hospitals$NAME, ma_er_hospitals$BEDS, sep = ", ")

#interactive map showing hospial beds available : with the number of beds acting as a proxy 
#for hospital capacity. Zooming into the map also gives a nice perspecive of observing the #clustering of hospitals around highways. 

leaflet(data = ma_er_hospitals,
        options = leafletOptions(
                         minZoom = 6, 
                         maxZoom = 15)) %>%
  addProviderTiles("Esri.WorldGrayCanvas") %>%
   addCircleMarkers(
              radius = ~ma_er_hospitals$RSIZE,
              color = ~BEDCOLORS,
              opacity = 50,
              weight = 5,
              popup = ~super_popup) %>%
    setView(lng = -71.8634062, lat = 42.3517586, zoom = 8)

#both color and radius of point represent bed size so the user has the clearest understanding #in discerning the differences between them. 

#In a very ideal world, we would have liked to create a Shiny interface that could allow the #user to toggle between the maps to look at all of the different relationships with hospitals #and owners, capacity, and funding, but we were unequipped.

```

As visualized on the map, there are large gaps between hospital coverage the farther west one moves in the state, and with a smaller capacity, save for the exception of Springfield. Additionally, looking at the bordering states, there are very few hospitals closer to the state lines that Massachusetts residents could potentially drive to as closer alternative. Also important to note is that there are no Critical Access hospitals, which are typically smaller in size and sophistication established to serve as an immediate resource for those in rural communities. 


# Do Existing Hospitals Keep up with Existing Population Demand?

The next logical question to ask given the large dinstances between emergency hospital locations across the state is whether these existing hospitals are able to meet the current demands of the population. To investigate this relationship, the map below plots the population density of Massachusetts (where a greater population is represented by a lighter color) and varying red points representing hospital capacity.

```{r, echo=FALSE, message=FALSE, warning=FALSE, collapse=TRUE, results='hide', fig.width = 16/2, fig.height = 12/2}

#Warning to the user: in order to produce this map, you need a us census API key personal to your email that you need to load prior to running the code below

#Narrowing down the huge tidycensus data to just show Massachusetts and population selected in #the variable category #and then grouped by county as this is helpful in our analysis to see #where rural and less densly populated areas in Western Mass

mass_pop_dens <- 
tidycensus::get_acs(
state = "MA",
geography = "county", 
variables = "B01003_001", 
geometry = TRUE
 )


#Filtered dataset to refine and only contain the state of MA as our data wrangling above includes the surrounding Massachusetts states.

ma_er_hospitals_beds <- ma_er_hospitals %>% filter(STATE == "MA")
                                                   

# Plotting a gradient cloropleth map based on population density of the state of massachusetts

ggplot() +
geom_sf(data = mass_pop_dens, aes(fill = estimate), size = 0.5) +
labs(y= "Longitude", x = "Latitude", title = "Hospital Capacity and Population Density in Massachusetts")+
guides(size=guide_legend(title="Beds Available")) +
coord_sf() +
scale_size(range = c(0, 9))+
labs(fill = "Population\nDensity") +
geom_point(data= ma_er_hospitals_beds, aes(x= LONGITUDE, y = LATITUDE, size = BEDS), color = "red", alpha = 0.5)

```

From this graph we can observe that the population is less dense in the farther west counties (than the East coast), and are populated by a smaller number of relatively small hospitals. However, the large gaps in distance between hospitals in the West is not offset by having a larger sized-hospital, as seen in the farthest left county. The most effective solution of care to accomodate for the less-dense populations is to have a greater number of small occupancy hospitals/emergency care locations as even though the population is smaller, rural residents still have to drive a farther distance and on less direct routes--zooming in on the previous map will show how hospitals are set up near major highways and are not as accessible for those who live farther from them). 

#Who Owns Hospitals in MA and Surrounding States?

The next question is analyzing the current government involvement in hospitals by charting hospital owners in the state and whether the Government is an active sponsor. 
The colors in the graph below are assigned with purple representing Non-Profit, orange for proprietary, and green for government. 


```{r, echo=FALSE, message=FALSE, warning=FALSE}
#I am commenting out the code of my beloved in devotion to the time I spent trying to figure out how to put a legend. The code still works if one would like a list of the values in the data and incorrect corresponding colors. 
#developing a pallete for the first leaflet map, for the labels on the legend to map to the same colors and hues above
 #palOWNER <- colorFactor(domain = ma_er_hospitals$SIMPLEOWNER,
         # palette(c("green","purple","orange")))   

#plotting interactive hospitals map to look at the ownership of hospitals in massachusetts and the surrounding states

leaflet(data = ma_er_hospitals,
        options = leafletOptions(
                         minZoom = 6, 
                         maxZoom = 15)) %>%
  addProviderTiles("CartoDB") %>%
   addCircleMarkers(
    radius = 5 ,
    color = ~ma_er_hospitals$color,
    popup = ~NAME) %>%
  setView(lng = -71.8634062, lat = 42.3517586, zoom = 8) #%>%

#addLegend(position = "bottomright",
  #values = ~SIMPLEOWNER,
  #labels = ~SIMPLEOWNER,
  #pal = palOWNER,
  #opacity = .75,
  #title = "Hospital Owners")
  
                  
```

As seen in the notably purple graph, only two hospitals in the state are owned by a government entity as seen in the two Cambridge Health Aliance chains near Boston, and these are classified as non-state government. This lacking absense of state government sponsorship of hospitals, reveals an opporunity for the government to intervene.

#Takeaways

Based on our findings above, we urge the Massachusetts state government to consider putting some of the increase of the[\$340 million dollar unexpected increase](https://www.masslive.com/politics/index.ssf/2018/07/heres_how_the_4188_billion_sta.html)in the 2019 Fiscal budget to sustain and support constituents who are the most in need - those vulnerable and need of access to emergency response services. This can be put toward establishing or funding more Critical Access hospitals as there are *none* in the state (denoted in the data), and severely behind other states, especially in the West. Another policy option is to provide incentives to new graduates to establish and set up their practices in rural areas through [tax breaks or loan forgiveness programs](http://www.wrvo.org/post/rural-areas-struggle-health-care-availability), or by sponsoring a [J-1 visa program](https://j1visa.state.gov/programs/physician#participants) to incentivize foreign doctors to practice in rural MA areas. Another action is to even solidify reliable, not [exponentially expensive access](https://www.washingtonpost.com/national/health-science/ambulance-trips-can-leave-you-with-surprising--and-very-expensive--bills/2017/11/17/6be9280e-c313-11e7-84bc-5e285c7f4512_story.html?utm_term=.24ca416c7661) for rural community members to travel to existing hospitals (such as funding or subsidizing ambulances with tax-payer funds). As a voter/resident of MA, we urge you to vote on any proposed ballot measures to increase spending for healthcare and health access and be vigilant in your contact with your representatives to bring their attention to the importance of this issue. 


#References and Citations

*[Hospital Data](https://hifld-geoplatform.opendata.arcgis.com/datasets/hospitals?geometry=-224.813%2C7.236%2C28.312%2C56.489){target="_blank"}, U.S. Department of Homeland Security, 2017.

*[Can I Use My Health Insurance Plan Outside of My State?](https://help.ihealthagents.com/hc/en-us/articles/224360547-Can-I-Use-My-Health-Insurance-Plan-Outside-of-My-State- ){target="_blank"}, iHealthAgents, December 2, 2018.

*[Here's how the $41.88 billion Massachusetts state budget would be spent](https://www.masslive.com/politics/index.ssf/2018/07/heres_how_the_4188_billion_sta.html){target="_blank"}, MassLive, July 18, 2018.

*[Exchange Visitor Program](https://j1visa.state.gov/programs/physician#participants ){target="_blank"},US Department of State.

*[Ambulance trips can leave you with surprising — and very expensive — bills](https://www.washingtonpost.com/national/health-science/ambulance-trips-can-leave-you-with-surprising--and-very-expensive--bills/2017/11/17/6be9280e-c313-11e7-84bc-5e285c7f4512_story.html?noredirect=on&utm_term=.9e84b640c71c ){target="_blank"}, Washington Post, November 20, 2017.

*[Image Citation](http://www.healthmediapolicy.com/wp-content/uploads/2017/05/RuralHospital.jpg){target="_blank"}, Health Media Policy, nd.

*[Census Data](https://www.census.gov/programs-surveys/decennial-census/data/datasets.2010.html){target="_blank"}, United States Census Bureau.

*[National Rural Health Association Policy Brief](https://www.ruralhealthweb.org/getattachment/Advocate/Policy-Documents/FutureofRuralHealthFeb-2013.pdf.aspx){target="_blank"}, National Rural Health Association, February 2013.



