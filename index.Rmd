---
title: "Life Expectancy in New England"
author: "Morgan Barney, Sarah Albert, and Ana Porro"
date: "Last updated on `r Sys.Date()`"
output:
  html_document:
    toc: true
    toc_depth: 2
    toc_float: true
    df_print: kable
---

<!--
Comments in HTML are like this! 
-->

```{r, include=FALSE}
#Load Packages
library(ggplot2)
library(tidyverse)
library(leaflet)
library(sf)
library(USAboundaries)
library(maps)
library(dplyr)
library(plyr)
library(readr)
library(knitr)
library(htmltools)
library(htmlwidgets)
library(RColorBrewer)
library(magrittr)
```

```{r, echo=FALSE, warning=FALSE, message=FALSE}
#Data Wrangling

#Load in shape file
cz_1990 <- "cz1990_shapefile" %>%
  read_sf()

#load in data sets
health_ineq_online_table_11 <- read_csv("health_ineq_online_table_11.csv")

health_ineq_online_table_12 <- read_csv("health_ineq_online_table_12.csv")

#select important variables from health_ineq_online_table_11
#this is so the full join goes nicely
health_ineq_online_table_11_v2 <- select(health_ineq_online_table_11, cty, statename, le_raceadj_q1_F, le_agg_q1_F, 
                                         le_raceadj_q2_F, le_agg_q2_F, le_raceadj_q3_F, le_agg_q3_F, 
                                         le_raceadj_q4_F, le_agg_q4_F, le_raceadj_q1_M, le_agg_q1_M, 
                                         le_raceadj_q2_M, le_agg_q2_M, le_raceadj_q3_M, le_agg_q3_M, 
                                         le_raceadj_q4_M, le_agg_q4_M)

#combine health_ineq_online_table_11 and health_ineq_online_table_12 by county (cty) and view
income_and_health_by_cty <- full_join(health_ineq_online_table_11_v2, health_ineq_online_table_12, by = "cty")

#combine income_and_health_by_cty and shapefile by communting zone (cz)
income_and_health_by_cz <- full_join(income_and_health_by_cty, cz_1990, by = "cz")

#filtering for NE States
income_and_health_by_cz_NE <- income_and_health_by_cz %>% filter(statename.x == "Massachusetts" | 
                                                                   statename.x == "Maine" |
                                                                   statename.x == "New Hampshire" |
                                                                   statename.x == "Vermont" |
                                                                   statename.x == "Rhode Island")
#View(income_and_health_by_cz_NE)
```


```{r, echo=FALSE, warning=FALSE, message=FALSE, fig.height= 10, fig.width= 14 }
#First Graph: Life Expectancy by Income Quartile and Gender


#create new column coded with income quartiles for life expectency by income quartile
income_and_mortlity_rates_NE <- income_and_health_by_cz_NE %>% 
  select(cty, statename.x, le_agg_q1_F, 
         le_agg_q2_F, le_agg_q3_F, le_agg_q4_F, 
         le_agg_q1_M, le_agg_q2_M, le_agg_q3_M, le_agg_q4_M,
         geometry, rel_tot, 
         scap_ski90pcm, cs00_seg_inc_aff75, poor_share) %>%
  #gathering
  gather(key = income_quartile, value = life_expectancy, le_agg_q1_F,
         le_agg_q2_F, le_agg_q3_F, le_agg_q4_F, le_agg_q1_M, le_agg_q2_M,
         le_agg_q3_M, le_agg_q4_M) 

#code as factor to order facets
income_and_mortlity_rates_NE$income_quartile_GG = factor(income_and_mortlity_rates_NE$income_quartile, levels=c('le_agg_q1_F','le_agg_q2_F','le_agg_q3_F','le_agg_q4_F', 'le_agg_q1_M', 'le_agg_q2_M','le_agg_q3_M', 'le_agg_q4_M'))
#lables for facets
levels=c('le_agg_q1_F','le_agg_q2_F','le_agg_q3_F','le_agg_q4_F', 'le_agg_q1_M', 'le_agg_q2_M','le_agg_q3_M', 'le_agg_q4_M')

income_quartile_GG2 <- c(le_agg_q1_F = "Quartile 1 Females", le_agg_q2_F = "Quartile 2 Females", le_agg_q3_F = "Quartile 3 Females", le_agg_q4_F = "Quartile 4 Females", 
                         le_agg_q1_M = "Quartile 1 Males", le_agg_q2_M = "Quartile 2 Males", le_agg_q3_M = "Quartile 3 Males", le_agg_q4_M = "Quartile 4 Males")


#recode variable as numeric to assign color value
income_and_mortlity_rates_NE <- income_and_mortlity_rates_NE %>%
transform(life_expectancy = as.numeric(life_expectancy))

#create new variable to assign color groups to
income_and_mortlity_rates_NE$life_expectancy_GROUPS <- cut(income_and_mortlity_rates_NE$life_expectancy, breaks = c( 70,73, 76, 79, 82, 85, 88, 91, Inf),
                            labels = c("70-72",
                                    "73-75",
                                    "76-78",
                                    "79-81",
                                    "82-84",
                                    "85-87",
                                    "88-90",
                                    "91 and Above"
                             ))

#plot life expectancy by income quartile and gender
ggplot() + geom_sf(data = income_and_mortlity_rates_NE, aes(fill = income_and_mortlity_rates_NE$life_expectancy_GROUPS)) + 
  facet_wrap(.~income_quartile_GG, labeller = labeller(income_quartile_GG=income_quartile_GG2), nrow = 2) + labs(title= "Life Expectancy per Income Quartile by Gender in New England", subtitle = "What role do income and gender play in life expectancy in the Northeast?", fill="Life \n Expectancy") + 
  coord_sf(xlim = c(-67, -74), ylim = c(41, 47.4)) +
 # ggtitle("Life Expectancy per Income Quartile by Gender in New England", subtitle = "What role do income and gender play in life expectancy in the Northeast?")+
  #change background to white
  theme(panel.background = element_blank(),
        axis.line = element_line(colour = "white"),
        #changes facet background and outline
        strip.background = element_rect(colour="white", fill="white"),
        #centers and bolds title and subtitle
        plot.title = element_text(hjust = 0.5, face = "bold"),
        plot.subtitle =element_text(hjust = 0.5),
      axis.text.x = element_blank(),
      axis.text.y = element_blank(),
      axis.ticks = element_blank(),
     legend.title = element_text(face = "bold")) +
      scale_fill_brewer(palette="YlOrRd") + 
  theme(legend.key.size = unit(8, "mm"))
     
#legend.key.size = unit(1, "strwidth") 

  #legend.key.size = 

```



This visualization displays the life expectancy of New Englanders in 2000 separated by both sex and income quartile.  The lowest income quartile is represented by the number 1, while the highest is by the number 4.  This data used in this analysis was taken from a paper titled “The Association between Income and Life Expectancy in the United States, 2001-2014” by Raj Chetty et al.  In their paper, they constructed income quartiles using income data for the US population through 1.4 billion deidentified tax records between 1999 and 2014. Additionally, mortality data was obtained from Social Security Administration death records. These data were used to estimate race- and ethnicity-adjusted life expectancy at 40 years of age by household income percentile, sex, and geographic area, and to evaluate factors associated with differences in life expectancy. 

Firstly, in New England, it appears that life expectancy per income quartile is not equivalent by gender.  This visualization shows that on average, women have a higher life expectancy than men in all income quartiles. Additionally, life expectancy increases by income quartile.  Therefore, perhaps unsurprisingly, it appears that life expectancy may be a byproduct of income inequality. It will be interesting to see if the correlation between income inequality and health inequality continues over specific health indicators that contribute to life expectancy, such as tobacco use, obesity, and frequency of exercise. Click on the [more info tab](https://rudeboybert.github.io/SDS192/projects.html#fnref1) to see! 
	 
	 




